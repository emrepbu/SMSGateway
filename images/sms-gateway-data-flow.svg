<svg viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg">
  <!-- Styles and definitions -->
  <defs>
    <linearGradient id="headerGradient" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" stop-color="#4776E6" />
      <stop offset="100%" stop-color="#8E54E9" />
    </linearGradient>
    <filter id="dropShadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="2" stdDeviation="3" flood-color="rgba(0,0,0,0.3)" />
    </filter>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#555" />
    </marker>
    <marker id="dataFlowArrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#4776E6" />
    </marker>
  </defs>

  <!-- Page title -->
  <rect x="10" y="10" width="780" height="50" rx="10" fill="url(#headerGradient)" filter="url(#dropShadow)" />
  <text x="400" y="42" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="white" text-anchor="middle">SMS Gateway Data Flow Process</text>

  <!-- Step 1: Incoming SMS -->
  <rect x="50" y="100" width="700" height="80" rx="10" fill="#e3f2fd" filter="url(#dropShadow)" />
  <text x="75" y="135" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#0d47a1">1. Receiving SMS</text>
  <text x="250" y="135" font-family="Arial, sans-serif" font-size="14" fill="#333">Android system broadcasts SMS_RECEIVED_ACTION</text>
  <text x="250" y="155" font-family="Arial, sans-serif" font-size="14" fill="#333">SmsReceiver captures message details: sender, body, timestamp</text>

  <!-- Step 2: Work Manager -->
  <rect x="50" y="190" width="700" height="80" rx="10" fill="#e8f5e9" filter="url(#dropShadow)" />
  <text x="75" y="225" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#2e7d32">2. Background Processing</text>
  <text x="250" y="225" font-family="Arial, sans-serif" font-size="14" fill="#333">SmsReceiver creates OneTimeWorkRequest for ProcessSmsWorker</text>
  <text x="250" y="245" font-family="Arial, sans-serif" font-size="14" fill="#333">Input data: SMS ID, sender, body, timestamp passed to worker</text>

  <!-- Step 3: Message Storage -->
  <rect x="50" y="280" width="700" height="80" rx="10" fill="#fff3e0" filter="url(#dropShadow)" />
  <text x="75" y="315" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#e65100">3. Message Storage</text>
  <text x="250" y="315" font-family="Arial, sans-serif" font-size="14" fill="#333">ProcessSmsWorker creates SmsMessage domain object</text>
  <text x="250" y="335" font-family="Arial, sans-serif" font-size="14" fill="#333">SmsRepository stores message in Room database with isForwarded=false</text>

  <!-- Step 4: Filter Processing -->
  <rect x="50" y="370" width="700" height="80" rx="10" fill="#f3e5f5" filter="url(#dropShadow)" />
  <text x="75" y="405" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#7b1fa2">4. Filter Application</text>
  <text x="250" y="405" font-family="Arial, sans-serif" font-size="14" fill="#333">ProcessNewSmsUseCase fetches enabled filter rules</text>
  <text x="250" y="425" font-family="Arial, sans-serif" font-size="14" fill="#333">ApplyFilterUseCase matches SMS content against rules, returns matches</text>

  <!-- Step 5: Email Forwarding -->
  <rect x="50" y="460" width="700" height="110" rx="10" fill="#ffebee" filter="url(#dropShadow)" />
  <text x="75" y="495" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#c62828">5. Email Forwarding</text>
  <text x="250" y="495" font-family="Arial, sans-serif" font-size="14" fill="#333">If filter matches found: Extract email addresses from matching rules</text>
  <text x="250" y="515" font-family="Arial, sans-serif" font-size="14" fill="#333">SendEmailForSmsUseCase formats and sends email with SMS content</text>
  <text x="250" y="535" font-family="Arial, sans-serif" font-size="14" fill="#333">Update message in database with isForwarded=true, forwardedAt timestamp</text>
  <text x="250" y="555" font-family="Arial, sans-serif" font-size="14" fill="#333">AppEvents notifies UI of completed processing</text>

  <!-- Data Flow Arrows - Vertical timeline arrows -->
  <line x1="400" y1="180" x2="400" y2="190" stroke="#4776E6" stroke-width="3" stroke-dasharray="5,3" marker-end="url(#dataFlowArrow)" />
  <line x1="400" y1="270" x2="400" y2="280" stroke="#4776E6" stroke-width="3" stroke-dasharray="5,3" marker-end="url(#dataFlowArrow)" />
  <line x1="400" y1="360" x2="400" y2="370" stroke="#4776E6" stroke-width="3" stroke-dasharray="5,3" marker-end="url(#dataFlowArrow)" />
  <line x1="400" y1="450" x2="400" y2="460" stroke="#4776E6" stroke-width="3" stroke-dasharray="5,3" marker-end="url(#dataFlowArrow)" />

  <!-- Data Elements -->
  <rect x="600" y="150" width="100" height="20" rx="5" fill="white" stroke="#4776E6" stroke-width="1.5" />
  <text x="650" y="165" font-family="Arial, sans-serif" font-size="12" fill="#4776E6" text-anchor="middle">Raw SMS Data</text>
  
  <rect x="600" y="230" width="100" height="20" rx="5" fill="white" stroke="#4776E6" stroke-width="1.5" />
  <text x="650" y="245" font-family="Arial, sans-serif" font-size="12" fill="#4776E6" text-anchor="middle">Work Request</text>
  
  <rect x="600" y="330" width="100" height="20" rx="5" fill="white" stroke="#4776E6" stroke-width="1.5" />
  <text x="650" y="345" font-family="Arial, sans-serif" font-size="12" fill="#4776E6" text-anchor="middle">SmsMessage</text>
  
  <rect x="600" y="410" width="100" height="20" rx="5" fill="white" stroke="#4776E6" stroke-width="1.5" />
  <text x="650" y="425" font-family="Arial, sans-serif" font-size="12" fill="#4776E6" text-anchor="middle">Filter Matches</text>
  
  <rect x="600" y="520" width="100" height="20" rx="5" fill="white" stroke="#4776E6" stroke-width="1.5" />
  <text x="650" y="535" font-family="Arial, sans-serif" font-size="12" fill="#4776E6" text-anchor="middle">Email Content</text>
</svg>